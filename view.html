<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>View Submissions</title>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
  import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";

  // ðŸ”¹ Replace with your Firebase Web App config
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_AUTH_DOMAIN",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_STORAGE_BUCKET",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // ---------------- Render Functions ----------------
  function renderNode(node) {
    const li = document.createElement("li");
    li.textContent = node.title;
    if (node.children && node.children.length > 0) {
      const ul = document.createElement("ul");
      node.children.forEach(child => ul.appendChild(renderNode(child)));
      li.appendChild(ul);
    }
    return li;
  }

  function renderTree(tree) {
    const ul = document.createElement("ul");
    tree.nodes.forEach(node => ul.appendChild(renderNode(node)));
    return ul;
  }

  // ---------------- Load Submissions ----------------
  async function loadSubmissions() {
    const container = document.getElementById("submissions");
    container.innerHTML = "<p>Loading submissions...</p>";

    const submissionsRef = collection(db, "submissions");
    const snapshot = await getDocs(submissionsRef);

    container.innerHTML = ""; // Clear loading text

    snapshot.forEach(doc => {
      const data = doc.data();

      const div = document.createElement("div");
      div.className = "submission";

      const header = document.createElement("h3");
      header.textContent = data.username + " (" + new Date(data.timestamp.seconds * 1000).toLocaleString() + ")";
      div.appendChild(header);

      // Render each tree
      data.trees.forEach((tree, index) => {
        const treeHeader = document.createElement("h4");
        treeHeader.textContent = "Tree " + (index + 1);
        div.appendChild(treeHeader);
        div.appendChild(renderTree(tree));
      });

      container.appendChild(div);
    });
  }

  window.onload = loadSubmissions;
</script>

<style>
body { font-family: sans-serif; margin: 2rem; }
ul { list-style-type: none; padding-left: 1rem; }
li { margin: 0.25rem 0; padding: 0.25rem; border: 1px solid #ccc; border-radius: 4px; }
.submission { margin-bottom: 2rem; padding: 1rem; border: 1px solid #aaa; border-radius: 6px; }
h3 { margin-bottom: 0.5rem; }
h4 { margin-top: 0.5rem; margin-bottom: 0.25rem; }
</style>
</head>
<body>

<h1>All Submitted Hierarchies</h1>
<div id="submissions"></div>

</body>
</html>
